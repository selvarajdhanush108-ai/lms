<!DOCTYPE html>
<html lang="en" class="bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link 
  rel="stylesheet" 
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css" 
  integrity="sha256-P3zHyg6Hy8rHZvYa+y2hbCnDKwcNXB4vB2xSH+npWkk=" 
  crossorigin="anonymous">
    <title>Library Hub</title>
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/1f2937/ffffff?text=Hub">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        document.addEventListener('DOMContentLoaded', () => {

            // --- CONFIGURATION ---
            const SUPABASE_URL = 'https://zzqftqssuqueegchzajs.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6cWZ0cXNzdXF1ZWVnY2h6YWpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2MzY5MjMsImV4cCI6MjA3NDIxMjkyM30.wpo4anjOvLFEpKS8eR7ESULLakNOj3dT-tN2OstSL0o';
            const SERVER_URL = 'https://lms-server-btmx.onrender.com';

            // --- STATE & ELEMENTS ---
            let supabase;
            let allBooks = [];
            let allOrders = [];
            let isAdmin = false;

            // Views & Lists
            const booksView = document.getElementById('booksView');
            const ordersView = document.getElementById('ordersView');
            const bookList = document.getElementById('bookList');
            const orderList = document.getElementById('orderList');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const ordersLoadingIndicator = document.getElementById('ordersLoadingIndicator');

            // Modals
            const addBookModal = document.getElementById('addBookModal');
            const addBookModalContent = document.getElementById('addBookModalContent');
            const orderBookModal = document.getElementById('orderBookModal');
            const orderBookModalContent = document.getElementById('orderBookModalContent');
            const loginModal = document.getElementById('loginModal');
            
            // Forms & Controls
            const searchInput = document.getElementById('searchInput');
            const addBookForm = document.getElementById('addBookForm');
            const orderBookForm = document.getElementById('orderBookForm');
            const loginForm = document.getElementById('loginForm');
            const adminControls = document.getElementById('adminControls');
            const publicHeader = document.getElementById('publicHeader');
            const adminHeader = document.getElementById('adminHeader');

            // Toast
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');

            // --- INITIALIZATION ---
            function initializeApp() {
                if (SUPABASE_URL.includes('YOUR_SUPABASE_URL')) {
                    loadingIndicator.innerHTML = `<div class="text-center p-8 text-yellow-400">Supabase not configured.</div>`;
                    return;
                }
                supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                checkAdminSession();
                fetchAndRenderBooks();
            }
            
            initializeApp();

            // --- EVENT LISTENERS ---
            document.getElementById('openModalBtn').addEventListener('click', () => openModal(addBookModal, addBookModalContent));
            document.getElementById('closeAddBookModalBtn').addEventListener('click', () => closeModal(addBookModal, addBookModalContent));
            document.getElementById('closeOrderBookModalBtn').addEventListener('click', () => closeModal(orderBookModal, orderBookModalContent));
            document.getElementById('adminLoginBtn').addEventListener('click', () => loginModal.classList.remove('hidden'));
            document.getElementById('closeLoginModalBtn').addEventListener('click', () => loginModal.classList.add('hidden'));
            addBookForm.addEventListener('submit', handleAddBook);
            orderBookForm.addEventListener('submit', handlePlaceOrder);
            loginForm.addEventListener('submit', handleLogin);
            searchInput.addEventListener('input', handleSearch);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('viewBooksBtn').addEventListener('click', () => switchView('books'));
            document.getElementById('viewOrdersBtn').addEventListener('click', () => switchView('orders'));
            
            bookList.addEventListener('click', handleBookListClick);
            orderList.addEventListener('click', handleOrderListClick);

            // Modal closing on outside click
            addBookModal.addEventListener('click', (e) => { if (e.target === addBookModal) closeModal(addBookModal, addBookModalContent); });
            orderBookModal.addEventListener('click', (e) => { if (e.target === orderBookModal) closeModal(orderBookModal, orderBookModalContent); });
            loginModal.addEventListener('click', (e) => { if (e.target === loginModal) loginModal.classList.add('hidden'); });

            // --- CORE FUNCTIONS ---

            function checkAdminSession() {
                if (sessionStorage.getItem('isAdminLoggedIn') === 'true') {
                    isAdmin = true;
                    updateUIForAdminState();
                }
            }
            
            function updateUIForAdminState() {
                publicHeader.classList.toggle('hidden', isAdmin);
                adminHeader.classList.toggle('hidden', !isAdmin);
                adminControls.classList.toggle('hidden', !isAdmin || !booksView.classList.contains('active-view'));
                renderBooks(allBooks);
            }

            function switchView(viewName) {
                const booksBtn = document.getElementById('viewBooksBtn');
                const ordersBtn = document.getElementById('viewOrdersBtn');

                if (viewName === 'books') {
                    booksView.classList.remove('hidden');
                    booksView.classList.add('active-view');
                    ordersView.classList.add('hidden');
                    ordersView.classList.remove('active-view');
                    booksBtn.classList.add('bg-gray-700');
                    ordersBtn.classList.remove('bg-gray-700');
                    adminControls.classList.toggle('hidden', !isAdmin);
                    if (allBooks.length === 0) fetchAndRenderBooks();
                } else if (viewName === 'orders') {
                    booksView.classList.add('hidden');
                    booksView.classList.remove('active-view');
                    ordersView.classList.remove('hidden');
                    ordersView.classList.add('active-view');
                    booksBtn.classList.remove('bg-gray-700');
                    ordersBtn.classList.add('bg-gray-700');
                    adminControls.classList.add('hidden');
                    fetchAndRenderOrders();
                }
            }
            
            async function fetchAndRenderBooks() {
                loadingIndicator.classList.remove('hidden');
                bookList.innerHTML = '';
                try {
                    const { data, error } = await supabase.from('books').select('*').order('created_at', { ascending: false });
                    if (error) throw error;
                    allBooks = data;
                    loadingIndicator.classList.add('hidden');
                    renderBooks(allBooks);
                } catch (error) {
                    loadingIndicator.classList.add('hidden');
                    bookList.innerHTML = `<div class="text-center p-8 text-red-400">Failed to fetch books.</div>`;
                }
            }

            async function fetchAndRenderOrders() {
                 ordersLoadingIndicator.classList.remove('hidden');
                 orderList.innerHTML = '';
                 try {
                     const response = await fetch(`${SERVER_URL}/get-orders`);
                     if (!response.ok) {
                        const errorResult = await response.json();
                        throw new Error(errorResult.error || 'Failed to fetch orders from server');
                     }
                     allOrders = await response.json();
                     ordersLoadingIndicator.classList.add('hidden');
                     renderOrders(allOrders);
                 } catch (error) {
                     ordersLoadingIndicator.classList.add('hidden');
                     orderList.innerHTML = `<div class="text-center p-8 text-red-400">${error.message}</div>`;
                 }
            }

            function renderBooks(books) {
                if (!books || books.length === 0) {
                    bookList.innerHTML = `<div class="text-center p-8 mt-10 text-gray-500">No books found.</div>`;
                    return;
                };
                const bookCards = books.map(book => `
                    <div class="book-card bg-gray-800 rounded-xl p-4 flex items-start space-x-4 shadow-lg relative fade-in-up" 
                         data-book-id="${book.id}" data-book-title="${book.title}" data-book-author="${book.author}" data-book-code="${book.book_code}">
                        <img src="${book.cover_image_url || 'https://placehold.co/80x120/1f2937/ffffff?text=Book'}" 
                             onerror="this.onerror=null;this.src='https://placehold.co/80x120/1f2937/ffffff?text=Error';"
                             alt="Cover of ${book.title}" class="w-20 h-30 object-cover rounded-md flex-shrink-0 shadow-md">
                        <div class="flex-grow">
                            <p class="text-indigo-400 text-xs font-semibold">${book.book_code || 'N/A'}</p>
                            <h3 class="font-bold text-lg text-white leading-tight">${book.title}</h3>
                            <p class="text-gray-400 text-sm">${book.author}</p>
                            <p class="text-gray-500 text-xs mt-2 capitalize bg-gray-700 inline-block px-2 py-1 rounded-full">${book.genre || 'No Genre'}</p>
                            <div class="flex items-center space-x-2 mt-3">
                                <div class="w-2.5 h-2.5 rounded-full ${book.is_available ? 'bg-green-400' : 'bg-yellow-500'}"></div>
                                <span class="text-xs font-medium ${book.is_available ? 'text-green-400' : 'text-yellow-500'}">
                                    ${book.is_available ? 'Available' : 'Checked Out'}
                                </span>
                            </div>
                        </div>
                        <div class="absolute top-4 right-4 flex flex-col items-end space-y-2">
                            ${isAdmin ? `
                                <button class="availability-toggle p-2 rounded-full bg-gray-700 hover:bg-gray-600" title="Toggle Availability" data-book-id="${book.id}" data-current-status="${book.is_available}">
                                    <svg class="h-5 w-5 text-white pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>
                                </button>
                            ` : `
                                <button class="order-btn p-2 rounded-full bg-indigo-600 hover:bg-indigo-700" title="Order this book">
                                    <svg class="h-5 w-5 text-white pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                                </button>
                            `}
                        </div>
                    </div>
                `).join('');
                bookList.innerHTML = bookCards;
            }

            function renderOrders(orders) {
                if (orders.length === 0) {
                    orderList.innerHTML = `<div class="text-center p-8 mt-10 text-gray-500">No book orders yet.</div>`;
                    return;
                }
                const orderCards = orders.map(order => `
                    <div class="order-card bg-gray-800 rounded-xl p-4 shadow-lg fade-in-up">
                        <div class="flex justify-between items-start">
                             <div>
                                <p class="text-sm text-gray-400">Order #${order.id}</p>
                                <h3 class="font-bold text-lg text-white">${order.book_title}</h3>
                                <p class="text-xs text-indigo-400 font-semibold">${order.book_code || 'N/A'}</p>
                             </div>
                             <button class="fulfill-btn p-2 rounded-full bg-green-600 hover:bg-green-700" title="Mark as Fulfilled" data-order-id="${order.id}">
                                <svg class="h-5 w-5 text-white pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                             </button>
                        </div>
                        <div class="mt-4 border-t border-gray-700 pt-4">
                            <p class="text-white"><span class="font-semibold">Student:</span> ${order.student_name}</p>
                            <p class="text-gray-400 text-sm"><span class="font-semibold">Class:</span> ${order.student_class || 'N/A'}</p>
                            <p class="text-gray-400 text-sm"><span class="font-semibold">Roll No:</span> ${order.student_roll_number || 'N/A'}</p>
                            <p class="text-gray-500 text-xs mt-2">Ordered on: ${new Date(order.created_at).toLocaleString()}</p>
                        </div>
                    </div>
                `).join('');
                orderList.innerHTML = orderCards;
            }
            
            function handleBookListClick(e) {
                const button = e.target.closest('button');
                if (!button) return;

                if (button.classList.contains('availability-toggle') && isAdmin) {
                    handleToggleAvailability(button.dataset.bookId, button.dataset.currentStatus !== 'true');
                } else if (button.classList.contains('order-btn')) {
                    const card = button.closest('.book-card');
                    openOrderModal({
                        id: card.dataset.bookId,
                        title: card.dataset.bookTitle,
                        author: card.dataset.bookAuthor,
                        code: card.dataset.bookCode
                    });
                }
            }
            
            function handleOrderListClick(e) {
                const fulfillButton = e.target.closest('.fulfill-btn');
                if (fulfillButton && isAdmin) {
                    const orderId = fulfillButton.dataset.orderId;
                    handleFulfillOrder(orderId);
                }
            }
            
            async function handleAddBook(e) {
                e.preventDefault();
                const submitButton = e.target.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerHTML = `<div class="spinner"></div> Adding...`;
                const newBook = Object.fromEntries(new FormData(e.target));
                try {
                    const response = await fetch(`${SERVER_URL}/upload-book`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newBook),
                    });
                    const result = await response.json();
                    if (!response.ok) throw new Error(result.error || 'Server error');
                    showToast('Book added successfully!');
                    closeModal(addBookModal, addBookModalContent);
                    e.target.reset(); 
                    fetchAndRenderBooks(); 
                } catch (error) {
                    showToast(`Error: ${error.message}`, true);
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Add Book to Library';
                }
            }
            
            async function handleFulfillOrder(orderId) {
                const card = document.querySelector(`.fulfill-btn[data-order-id="${orderId}"]`).closest('.order-card');
                if (card) card.style.opacity = '0.5';
                try {
                    const response = await fetch(`${SERVER_URL}/fulfill-order/${orderId}`, {
                        method: 'DELETE',
                    });
                    if (!response.ok) {
                        const result = await response.json();
                        throw new Error(result.error || 'Failed to fulfill order');
                    }
                    showToast('Order fulfilled!');
                    allOrders = allOrders.filter(order => order.id != orderId);
                    renderOrders(allOrders);
                } catch (error) {
                    showToast(error.message, true);
                    if (card) card.style.opacity = '1';
                }
            }

            async function handleToggleAvailability(bookId, newStatus) {
                const card = document.querySelector(`.book-card[data-book-id="${bookId}"]`);
                if(card) card.style.opacity = '0.5';
                try {
                    const response = await fetch(`${SERVER_URL}/update-availability`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ bookId: parseInt(bookId), isAvailable: newStatus }),
                    });
                    if (!response.ok) throw new Error('Failed to update status');
                    showToast('Status updated!');
                    const bookIndex = allBooks.findIndex(b => b.id == bookId);
                    if (bookIndex !== -1) {
                        allBooks[bookIndex].is_available = newStatus;
                        renderBooks(allBooks);
                    } else {
                        fetchAndRenderBooks();
                    }
                } catch (error) {
                    showToast(error.message, true);
                    if(card) card.style.opacity = '1';
                }
            }
            
            async function handlePlaceOrder(e) {
                e.preventDefault();
                const submitButton = e.target.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerHTML = `<div class="spinner"></div> Ordering...`;
                const orderDetails = Object.fromEntries(new FormData(e.target));
                try {
                    const response = await fetch(`${SERVER_URL}/place-order`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(orderDetails),
                    });
                     if (!response.ok) {
                        const result = await response.json();
                        throw new Error(result.error || 'Failed to place order');
                     }
                     showToast('Book ordered successfully!');
                     closeModal(orderBookModal, orderBookModalContent);
                     e.target.reset();
                } catch (error) {
                    showToast(error.message, true);
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Confirm Order';
                }
            }

            function handleLogin(e) {
                e.preventDefault();
                const { username, password } = Object.fromEntries(new FormData(e.target));
                if (username === 'admin' && password === 'adbmsmp') {
                    isAdmin = true;
                    sessionStorage.setItem('isAdminLoggedIn', 'true');
                    loginModal.classList.add('hidden');
                    loginForm.reset();
                    showToast('Welcome, Admin!');
                    updateUIForAdminState();
                } else {
                    showToast('Invalid credentials', true);
                }
            }

            function handleLogout() {
                isAdmin = false;
                sessionStorage.removeItem('isAdminLoggedIn');
                showToast('Logged out.');
                updateUIForAdminState();
                switchView('books');
            }

            function handleSearch(e) {
                const searchTerm = e.target.value.toLowerCase();
                if (!allBooks) return;
                const filteredBooks = allBooks.filter(book => 
                    book.title.toLowerCase().includes(searchTerm) || 
                    book.author.toLowerCase().includes(searchTerm) ||
                    (book.book_code && book.book_code.toLowerCase().includes(searchTerm))
                );
                renderBooks(filteredBooks);
            }
            
            function openOrderModal(book) {
                document.getElementById('order_book_id').value = book.id;
                document.getElementById('order_book_title_display').textContent = book.title;
                document.getElementById('order_book_author_display').textContent = book.author;
                orderBookForm.querySelector('input[name="book_title"]').value = book.title;
                orderBookForm.querySelector('input[name="book_code"]').value = book.code;
                openModal(orderBookModal, orderBookModalContent);
            }
            
            function showToast(message, isError = false) {
                toastMessage.textContent = message;
                toast.className = `fixed bottom-20 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg text-white transition-all duration-300 toast-enter ${isError ? 'bg-red-600' : 'bg-green-600'}`;
                setTimeout(() => {
                    toast.classList.remove('toast-enter', 'toast-exit');
                    toast.classList.add('toast-exit');
                    setTimeout(() => toast.className = 'hidden', 300);
                }, 3000);
            }

            function openModal(modalEl, contentEl) {
                modalEl.classList.remove('hidden');
                setTimeout(() => contentEl.classList.remove('translate-y-full'), 10);
            }

            function closeModal(modalEl, contentEl) {
                contentEl.classList.add('translate-y-full');
                setTimeout(() => modalEl.classList.add('hidden'), 300);
            }
        });
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .spinner { width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; margin-right: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in-up { opacity: 0; transform: translateY(20px); animation: fadeInUp 0.5s ease-out forwards; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .toast-enter { opacity: 0; transform: translate(-50%, 10px); }
        .toast-exit { opacity: 0; transform: translate(-50%, 10px); }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- App Container -->
    <div class="max-w-md mx-auto min-h-screen bg-gray-900 flex flex-col">

        <!-- Header -->
        <header class="bg-gray-800/80 backdrop-blur-sm sticky top-0 z-10 p-4 shadow-lg">
            <div id="publicHeader">
                 <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3"><i class="fa-solid fa-book-open text-indigo-400 text-xl"></i><h1 class="text-xl font-bold text-white">Lib Hub</h1></div>
                    <button id="adminLoginBtn" class="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-md">Admin Login</button>
                </div>
            </div>
             <div id="adminHeader" class="hidden">
                 <div class="flex items-center justify-between">
                    <h1 class="text-xl font-bold text-white">Admin Panel</h1>
                    <button id="logoutBtn" class="text-sm bg-red-600 hover:bg-red-700 px-3 py-1 rounded-md">Logout</button>
                </div>
                <div class="mt-4 flex bg-gray-900/50 rounded-lg p-1">
                    <button id="viewBooksBtn" class="flex-1 text-sm font-semibold p-2 rounded-md bg-gray-700">Manage Books</button>
                    <button id="viewOrdersBtn" class="flex-1 text-sm font-semibold p-2 rounded-md">View Orders</button>
                </div>
            </div>
            <div id="searchContainer" class="relative mt-4">
                <input id="searchInput" type="text" placeholder="Search by title, author, or code..." class="w-full bg-gray-700/50 text-white rounded-md p-3 pl-10 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <svg class="w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow p-4">
            <div id="booksView" class="active-view">
                <div id="loadingIndicator" class="grid grid-cols-1 gap-4">
                    <div class="bg-gray-800 rounded-xl p-4 flex items-start space-x-4 animate-pulse"><div class="w-20 h-30 bg-gray-700 rounded-md"></div><div class="flex-grow space-y-3 pt-1"><div class="w-3/4 h-5 bg-gray-700 rounded"></div><div class="w-1/2 h-4 bg-gray-700 rounded"></div><div class="w-1/4 h-5 bg-gray-700 rounded-full mt-2"></div></div></div>
                </div>
                <div id="bookList" class="grid grid-cols-1 gap-4"></div>
            </div>
            <div id="ordersView" class="hidden">
                 <div id="ordersLoadingIndicator" class="grid grid-cols-1 gap-4">
                    <div class="bg-gray-800 rounded-xl p-4 space-y-3 animate-pulse"><div class="w-3/4 h-5 bg-gray-700 rounded"></div><div class="w-1/2 h-4 bg-gray-700 rounded"></div></div>
                 </div>
                 <div id="orderList" class="grid grid-cols-1 gap-4"></div>
            </div>
        </main>
        
        <div id="adminControls" class="hidden sticky bottom-0 right-0 p-6 flex justify-end">
            <button id="openModalBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold w-14 h-14 rounded-full flex items-center justify-center shadow-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg></button>
        </div>
    </div>

    <!-- Add Book Modal -->
    <div id="addBookModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-end justify-center z-20">
        <div id="addBookModalContent" class="bg-gray-800 rounded-t-2xl p-6 w-full max-w-md transition-transform duration-300 ease-in-out translate-y-full">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Add a New Book</h2><button id="closeAddBookModalBtn" class="text-2xl">&times;</button></div>
            <form id="addBookForm" class="space-y-4">
                 <div><label for="book_code" class="text-sm font-medium text-gray-400">Book Code (Unique)</label><input type="text" id="book_code" name="book_code" placeholder="e.g., FIC-001" class="mt-1 w-full bg-gray-700 text-white rounded-md p-3" required></div>
                 <div><label for="title" class="text-sm font-medium text-gray-400">Title</label><input type="text" id="title" name="title" placeholder="e.g., The Midnight Library" class="mt-1 w-full bg-gray-700 text-white rounded-md p-3" required></div>
                 <div><label for="author" class="text-sm font-medium text-gray-400">Author</label><input type="text" id="author" name="author" placeholder="e.g., Matt Haig" class="mt-1 w-full bg-gray-700 text-white rounded-md p-3" required></div>
                 <div><label for="genre" class="text-sm font-medium text-gray-400">Genre</label><input type="text" id="genre" name="genre" placeholder="e.g., Fantasy" class="mt-1 w-full bg-gray-700 text-white rounded-md p-3"></div>
                 <div><label for="cover_image_url" class="text-sm font-medium text-gray-400">Cover URL</label><input type="url" name="cover_image_url" placeholder="https://..." class="mt-1 w-full bg-gray-700 text-white rounded-md p-3"></div>
                 <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl">Add Book to Library</button>
            </form>
        </div>
    </div>

    <!-- Order Book Modal -->
    <div id="orderBookModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-end justify-center z-20">
        <div id="orderBookModalContent" class="bg-gray-800 rounded-t-2xl p-6 w-full max-w-md transition-transform duration-300 ease-in-out translate-y-full">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Order Book</h2><button id="closeOrderBookModalBtn" class="text-2xl">&times;</button></div>
            <div class="mb-4 p-3 bg-gray-700/50 rounded-lg">
                <h3 id="order_book_title_display" class="font-semibold text-white"></h3>
                <p id="order_book_author_display" class="text-sm text-gray-400"></p>
            </div>
            <form id="orderBookForm" class="space-y-4">
                 <input type="hidden" id="order_book_id" name="book_id">
                 <input type="hidden" name="book_title">
                 <input type="hidden" name="book_code">
                 <div><label class="text-sm font-medium text-gray-400">Your Name</label><input type="text" name="student_name" placeholder="e.g., Dhanush S" class="mt-1 w-full bg-gray-700 text-white rounded-md p-3" required></div>
                 <div><label class="text-sm font-medium text-gray-400">Class</label><input type="text" name="student_class" placeholder="e.g., I - MCA" class="mt-1 w-full bg-gray-700 text-white rounded-md p-3"></div>
                 <div><label class="text-sm font-medium text-gray-400">Roll Number</label><input type="text" name="student_roll_number" placeholder="e.g., 9" class="mt-1 w-full bg-gray-700 text-white rounded-md p-3"></div>
                 <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl">Confirm Order</button>
            </form>
        </div>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-30 p-4">
         <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Admin Access</h2><button id="closeLoginModalBtn" class="text-gray-400 text-2xl">&times;</button></div>
            <form id="loginForm" class="space-y-4">
                <input type="text" name="username" placeholder="Username" class="w-full bg-gray-700 rounded-md p-3" required>
                <input type="password" name="password" placeholder="Password" class="w-full bg-gray-700 rounded-md p-3" required>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-md">Login</button>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden"><p id="toastMessage"></p></div>
</body>
</html>

